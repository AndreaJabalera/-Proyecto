import pandas as pd
import numpy as np

# Cargar los archivos CSV
eventos_df = pd.read_csv('/workspace/eventos.csv')
aficionados_df = pd.read_csv('/workspace/aficionados.csv')
promociones_df = pd.read_csv('/workspace/promociones.csv')

# Eliminar filas con valores nulos
eventos_df = eventos_df.dropna()
aficionados_df = aficionados_df.dropna()
promociones_df = promociones_df.dropna()

# Combinar los DataFrames utilizando 'id_evento' como clave
df_combinado = pd.merge(eventos_df, aficionados_df, on='id_evento', how='inner')
df_combinado = pd.merge(df_combinado, promociones_df, on='id_evento', how='inner')

# ¿Cuál es el evento con mayor asistencia total?
evento_mayor_asistencia = df_combinado.loc[df_combinado['asistentes_totales'].idxmax()]
print(f"El evento con mayor asistencia total es: {evento_mayor_asistencia['nombre_evento']}")

# ¿Qué rango de edad asiste más frecuentemente a los eventos?
bins = [0, 18, 30, 40, 50, np.inf]
labels = ['0-18', '19-30', '31-40', '41-50', '50+']
df_combinado['rango_edad'] = pd.cut(df_combinado['edad'], bins=bins, labels=labels)
rango_edad_mas_frecuente = df_combinado['rango_edad'].value_counts().idxmax()
print(f"El rango de edad más frecuente es: {rango_edad_mas_frecuente}")

# ¿Qué medio publicitario ha generado mayor impacto en términos de asistencia?
df_combinado['impacto_promocion'] = df_combinado['asistentes_totales'] / df_combinado['presupuesto_promocion']
medio_mayor_impacto = df_combinado.groupby('medio_publicitario')['impacto_promocion'].mean().idxmax()
print(f"El medio publicitario con mayor impacto es: {medio_mayor_impacto}")

# ¿Cuál es la ubicación de residencia que más aficionados aporta a los eventos?
ubicacion_mas_frecuente = df_combinado['ubicacion_residencia'].value_counts().idxmax()
print(f"La ubicación de residencia que más aficionados aporta es: {ubicacion_mas_frecuente}")

# Exportar el DataFrame final
df_combinado.to_csv('/workspace/reporte_eventos.csv', index=False)
